## Project Architecture

This is a **self-hosted CMS platform** (similar to WordPress) that users can install on their own servers/hosting.

## ⚠️ CRITICAL: Database Management Rules

**NEVER** use these commands:
- ❌ `php artisan migrate:fresh`
- ❌ `php artisan migrate:refresh`
- ❌ `php artisan db:wipe`
- ❌ Any command that drops or resets the entire database

**ONLY** use these commands:
- ✅ `php artisan migrate` - Run new migrations
- ✅ `php artisan migrate:rollback` - Rollback the last migration batch
- ✅ `php artisan migrate:rollback --step=N` - Rollback N migration batches

**Reason**: This is a production-style application with seeded data (genres, vibes, instruments) and potentially user-generated content. Dropping the database would destroy all data.

### Framework Usage Guidelines
- **Frontend (Public-facing website)**: Use **Livewire 3.x** + **Alpine.js 3.x** only
- **Admin Panel**: Use **Filament 4.x** exclusively
- **Styling**: Tailwind CSS 4.x for both frontend and admin

### Deployment Model
- Users download/purchase the complete package (including vendor folder)
- Upload all files to their hosting/web server and run installation wizard
- System works immediately (assuming server meets requirements)

### Server Requirements
- PHP 8.2+
- MySQL/MariaDB or PostgreSQL
- Composer installed (for initial setup)
- Standard LAMP/LEMP stack capabilities

## Framework Documentation
Use these version-specific documentation links based on current project dependencies:

### Backend (PHP/Laravel)
- **Laravel 12.x**: https://laravel.com/docs/12.x
- **Filament 4.x**: https://filamentphp.com/docs/4.x/panels/installation
- **Livewire 3.x**: https://livewire.laravel.com/docs/3.x/quickstart (included with Filament 4.x)

### Frontend
- **Tailwind CSS 4.x**: https://tailwindcss.com/docs/v4/installation
- **Alpine.js 3.x**: https://alpinejs.dev/start-here (included with Livewire/Filament)

### Additional Packages
- **Filament Language Switch 4.x**: https://github.com/bezhansalleh/filament-language-switch
- **Filament Blog 3.x**: https://github.com/firefly/filament-blog
- **Filament Shield 4.x**: https://filamentphp.com/plugins/bezhansalleh-shield (Roles & Permissions)
- **Spatie Laravel Permission 6.x**: https://spatie.be/docs/laravel-permission (Backend permission system)

## Authentication, Roles & Permissions

This project uses **Filament Shield** for comprehensive role-based access control (RBAC) in the admin panel.

### System Overview
- **Authentication**: Built on Laravel's authentication system with Filament UI
- **Roles & Permissions**: Managed by Filament Shield (UI) + Spatie Laravel Permission (backend)
- **Super Admin**: Special role with unrestricted access to all resources

### Default Admin Credentials
- **Email**: `admin@admin.com`
- **Password**: `admin`
- **Role**: `super_admin` (full access to all features)

### User Management
- **Location**: Admin Panel → Settings → Users (`/admin/users`)
- **Features**:
  - Create/edit/delete users
  - Assign roles to users
  - Manage email verification status
  - Secure password hashing (auto-handled)

### Role Management
- **Location**: Admin Panel → Shield → Roles (`/admin/shield/roles`)
- **Features**:
  - Create custom roles
  - Assign granular permissions per role
  - Permissions are auto-generated for all resources, pages, and widgets
  - Super admin bypasses all permission checks

### Permission Structure
Permissions follow this naming convention: `{action}:{Entity}`

**Resource Permissions** (11 per resource):
- `view:User` - View user records
- `viewAny:User` - List users
- `create:User` - Create new users
- `update:User` - Edit users
- `delete:User` - Delete users
- `restore:User` - Restore soft-deleted users
- `forceDelete:User` - Permanently delete users
- `forceDeleteAny:User` - Bulk permanent delete
- `restoreAny:User` - Bulk restore
- `replicate:User` - Duplicate users
- `reorder:User` - Reorder users

**Page Permissions**:
- `view:{PageClass}` - Access specific admin pages

**Widget Permissions**:
- `view:{WidgetClass}` - View dashboard widgets

### Current Resources with Permissions
1. **Users** (`app/Filament/Resources/Users/UserResource.php`)
   - Full CRUD management
   - Role assignment interface
   - Password management

2. **Roles** (Built into Shield)
   - Role creation/management
   - Permission assignment per role

3. **Blog Resources** (via Filament Blog):
   - Categories
   - Posts
   - Comments
   - Tags
   - Newsletter
   - SEO Details
   - Settings
   - Share Snippets

### Adding New Resources with Permissions

When creating a new Filament resource:

```bash
# 1. Create the resource
php artisan make:filament-resource MyModel --generate

# 2. Generate permissions and policy
php artisan shield:generate --resource=MyModelResource --panel=admin

# 3. Assign permissions to roles via admin UI
```

### Checking Permissions in Code

```php
// In policies (auto-generated by Shield)
public function view(User $user, Model $model): bool
{
    return $user->can('view:Model');
}

// In resources/pages
protected function canAccess(): bool
{
    return auth()->user()->can('view:MyPage');
}

// Direct checks
if (auth()->user()->hasRole('super_admin')) { }
if (auth()->user()->can('create:User')) { }
```

### Database Tables
- `users` - User accounts
- `roles` - Available roles
- `permissions` - Available permissions
- `model_has_permissions` - Direct user permissions
- `model_has_roles` - User-role assignments
- `role_has_permissions` - Role-permission assignments

### Configuration Files
- `config/filament-shield.php` - Shield settings
- `config/permission.php` - Spatie Permission settings
- `app/Providers/Filament/AdminPanelProvider.php` - Shield plugin registration

### Policies Location
Auto-generated policies are stored in: `app/Policies/`

### Important Notes
- Super admin role bypasses all permission checks
- Password fields auto-hash on save
- When editing users, password can be left blank to keep existing
- Roles display as badges in user list
- All resources automatically get policies and permissions when generated